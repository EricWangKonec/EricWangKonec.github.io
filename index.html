<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>版本发布月报</title>
    <style>
        :root {
            --primary-color: #FFD700;
            --secondary-color: #FFDF4F;
            --accent-color: #ff6b6b;
            --dark-gold: #D4AF37;
            --light-gold: #FFF4C2;
            --text-color: #333;
            --text-secondary: #555;
            --light-gray: #f8f8f8;
            --border-color: #e0e0e0;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --fix-color: #5c6bc0;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            
            /* 降低饱和度的节点颜色 */
            --main-color: #5B8DC9;
            --branch-color: #E09B47;
            --branch-start-color: #6BBE59;
            --branch-merge-color: #E06B6B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f9f9f9;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #f7f9fc 100%);
            padding: 20px 0;
            margin: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .header-bg {
            background: linear-gradient(135deg, #FFD700 0%, #FFDF4F 100%);
            height: 100;
            position: relative;
        }

        .header-content {
            position: relative;
            padding: 40px 30px 20px;
        }

        .release-title {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin: 10px 0 5px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .release-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .main-content {
            padding: 40px 30px;
        }
        
        #diagram-container {
            width: 100%;
            overflow-x: auto;
            background-color: var(--light-gray);
            border-radius: 12px;
            padding: 30px 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #diagram-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        svg {
            width: 100%;
            min-width: 1200px;
            height: 600px;
        }
        
        .main-line {
            stroke: var(--main-color);
            stroke-width: 3;
            fill: none;
            opacity: 0.8;
        }
        
        .branch-line {
            stroke: var(--branch-color);
            stroke-width: 2.5;
            fill: none;
            stroke-dasharray: 0;
            opacity: 0.8;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover circle {
            transform: translateY(-3px);
            filter: brightness(1.1) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .main-node {
            fill: var(--main-color);
            stroke: white;
            stroke-width: 3;
        }
        
        .branch-node {
            fill: var(--branch-color);
            stroke: white;
            stroke-width: 3;
        }
        
        .branch-start-node {
            fill: var(--branch-start-color);
            stroke: white;
            stroke-width: 3;
        }
        
        .branch-merge-node {
            fill: var(--branch-merge-color);
            stroke: white;
            stroke-width: 3;
        }
        
        .node-label {
            font-size: 13px;
            font-weight: 600;
            fill: var(--text-color);
            text-anchor: middle;
            pointer-events: none;
        }
        
        .date-label {
            font-size: 12px;
            fill: var(--text-secondary);
            text-anchor: middle;
            pointer-events: none;
        }
        
        .tooltip {
            position: fixed;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.85) 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tooltip.visible {
            opacity: 1;
        }

        .tooltip div {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .tooltip div:last-child {
            margin-bottom: 0;
        }

        .tooltip strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .legend {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            padding: 20px;
            background-color: var(--light-gray);
            border-radius: 12px;
            font-size: 14px;
            justify-content: center;
            box-shadow: var(--card-shadow);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: white;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .legend-text {
            font-weight: 500;
            color: var(--text-color);
        }

        .generated-time {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 8px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .container {
                border-radius: 0;
                box-shadow: none;
            }
            
            .header-content {
                padding: 15px 20px;
            }
            
            .main-content {
                padding: 10px 10px;
            }
            
            h1 {
                font-size: 26px;
            }

            .legend {
                flex-wrap: wrap;
                gap: 15px;
            }

            .legend-item {
                flex: 1 1 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-bg">
            <div class="header-content">
                <div class="release-title">
                    <h1>本月版本分支图</h1>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div id="diagram-container">
                <svg id="release-diagram"></svg>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--main-color);"></div>
                    <span class="legend-text">主版本</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--branch-color);"></div>
                    <span class="legend-text">分支版本</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--branch-start-color);"></div>
                    <span class="legend-text">分支开始</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--branch-merge-color);"></div>
                    <span class="legend-text">分支合并</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // 版本数据
        const releasesData = {
  "releases": [
    {
      "version": "1.0.14.156",
      "environment": "PROD",
      "date": "2025-05-01",
      "type": "main",
      "note": "主版本"
    },
    {
      "version": "1.0.14.157",
      "environment": "PROD",
      "date": "2025-05-15",
      "type": "branch-start",
      "note": "分支版本开始"
    },
    {
      "version": "1.0.14.158",
      "environment": "PROD",
      "date": "2025-05-16",
      "type": "main",
      "note": "主版本"
    },
    {
      "version": "1.0.14.159",
      "environment": "PROD",
      "date": "2025-05-19",
      "type": "branch",
      "note": "分支版本"
    },
    {
      "version": "1.0.14.160",
      "environment": "PROD",
      "date": "2025-05-21",
      "type": "branch",
      "note": "分支版本"
    },
    {
      "version": "1.0.14.161",
      "environment": "PROD",
      "date": "2025-05-22",
      "type": "branch",
      "note": "分支版本"
    },
    {
      "version": "1.0.14.162",
      "environment": "PROD",
      "date": "2025-05-23",
      "type": "branch",
      "note": "分支版本"
    },
    {
      "version": "1.0.14.163",
      "environment": "PROD",
      "date": "2025-05-26",
      "type": "branch",
      "note": "分支版本"
    },
    {
      "version": "1.0.14.164",
      "environment": "PROD",
      "date": "2025-05-27",
      "type": "branch-merge",
      "note": "分支版本核入为主版本"
    },
    {
      "version": "1.0.14.165",
      "environment": "PROD",
      "date": "2025-05-28",
      "type": "main",
      "note": "主版本"
    },
    {
      "version": "1.0.14.166",
      "environment": "PROD",
      "date": "2025-05-29",
      "type": "main",
      "note": "主版本"
    },
    {
      "version": "1.0.14.167",
      "environment": "PROD",
      "date": "2025-05-30",
      "type": "main",
      "note": "主版本"
    },
    {
      "version": "1.0.14.169",
      "environment": "PROD",
      "date": "2025-06-01",
      "type": "main",
      "note": "主版本"
    },
    {
      "version": "1.0.14.170",
      "environment": "PROD",
      "date": "2025-06-03",
      "type": "branch-start",
      "note": "分支版本开始"
    }
  ]
};
        
        function drawDiagram(releases) {
            const svg = document.getElementById('release-diagram');
            svg.innerHTML = '';
            
            const margin = { top: 80, right: 80, bottom: 80, left: 50 };
            const width = Math.max(1200, releases.length * 100 + 100);
            const height = 600;
            
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
            
            // 计算日期范围
            const dates = releases.map(r => new Date(r.date));
            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));
            const dateRange = maxDate - minDate;
            
            // 创建 x 轴比例尺 - 留出额外空间给箭头
            const xScale = (date) => {
                const d = new Date(date);
                return margin.left + ((d - minDate) / dateRange) * (width - margin.left - margin.right - 50);
            };
            
            const mainY = height / 2;
            const branchY = height / 2 + 150;
            
            // 分离主版本和分支版本
            const mainReleases = [];
            const branchReleases = [];
            let inBranch = false;
            let branchStartIndex = -1;
            
            releases.forEach((release, index) => {
                if (release.type === 'branch-start') {
                    inBranch = true;
                    branchStartIndex = index;
                    mainReleases.push(release);
                    branchReleases.push(release);
                } else if (release.type === 'branch-merge') {
                    inBranch = false;
                    branchReleases.push(release);
                    mainReleases.push(release);
                } else if (inBranch && release.type === 'branch') {
                    branchReleases.push(release);
                } else {
                    mainReleases.push(release);
                }
            });
            
            // 创建渐变定义
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            
            // 主线渐变
            const mainGradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            mainGradient.setAttribute('id', 'mainGradient');
            mainGradient.setAttribute('x1', '0%');
            mainGradient.setAttribute('x2', '100%');
            
            const mainStop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            mainStop1.setAttribute('offset', '0%');
            mainStop1.setAttribute('stop-color', 'var(--main-color)');
            mainStop1.setAttribute('stop-opacity', '0.8');
            
            const mainStop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            mainStop2.setAttribute('offset', '100%');
            mainStop2.setAttribute('stop-color', 'var(--main-color)');
            mainStop2.setAttribute('stop-opacity', '0.6');
            
            mainGradient.appendChild(mainStop1);
            mainGradient.appendChild(mainStop2);
            defs.appendChild(mainGradient);
            
            // 箭头标记
            const arrowMarker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            arrowMarker.setAttribute('id', 'arrowhead');
            arrowMarker.setAttribute('markerWidth', '10');
            arrowMarker.setAttribute('markerHeight', '7');
            arrowMarker.setAttribute('refX', '9');
            arrowMarker.setAttribute('refY', '3.5');
            arrowMarker.setAttribute('orient', 'auto');
            
            const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            arrow.setAttribute('points', '0 0, 10 3.5, 0 7');
            arrow.setAttribute('fill', 'var(--main-color)');
            arrow.setAttribute('opacity', '0.8');
            
            arrowMarker.appendChild(arrow);
            defs.appendChild(arrowMarker);
            svg.appendChild(defs);
            
            // 绘制主线（带箭头）
            if (mainReleases.length > 1) {
                const lastX = xScale(mainReleases[mainReleases.length - 1].date);
                const extendedX = width - margin.right + 20;
                
                let pathData = `M ${xScale(mainReleases[0].date)} ${mainY}`;
                for (let i = 1; i < mainReleases.length; i++) {
                    pathData += ` L ${xScale(mainReleases[i].date)} ${mainY}`;
                }
                // 延伸到箭头
                pathData += ` L ${extendedX} ${mainY}`;
                
                const mainLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                mainLine.setAttribute('d', pathData);
                mainLine.setAttribute('class', 'main-line');
                mainLine.setAttribute('stroke', 'url(#mainGradient)');
                mainLine.setAttribute('marker-end', 'url(#arrowhead)');
                svg.appendChild(mainLine);
            }
            
            // 绘制分支线（使用折线和圆角）
            let currentBranchStart = null;
            releases.forEach((release, index) => {
                if (release.type === 'branch-start') {
                    currentBranchStart = release;
                } else if (release.type === 'branch-merge' && currentBranchStart) {
                    // 绘制分支折线
                    const startX = xScale(currentBranchStart.date);
                    const endX = xScale(release.date);
                    
                    // 收集这个分支的所有节点
                    const branchNodes = releases.filter((r, i) => {
                        const rDate = new Date(r.date);
                        const startDate = new Date(currentBranchStart.date);
                        const endDate = new Date(release.date);
                        return rDate >= startDate && rDate <= endDate && 
                               (r.type === 'branch' || r.type === 'branch-start' || r.type === 'branch-merge');
                    });
                    
                    if (branchNodes.length > 0) {
                        const cornerRadius = 20;
                        let pathData = `M ${startX} ${mainY}`;
                        
                        // 下降段 - 直接到转角起点
                        pathData += ` L ${startX} ${branchY - cornerRadius}`;
                        // 圆角转折
                        pathData += ` Q ${startX} ${branchY}, ${startX + cornerRadius} ${branchY}`;
                        
                        // 如果有多个分支节点，连接它们
                        if (branchNodes.length > 1) {
                            for (let i = 1; i < branchNodes.length - 1; i++) {
                                pathData += ` L ${xScale(branchNodes[i].date)} ${branchY}`;
                            }
                        }
                        
                        // 连接到最后一个节点前的转角点
                        pathData += ` L ${endX - cornerRadius} ${branchY}`;
                        // 圆角转折
                        pathData += ` Q ${endX} ${branchY}, ${endX} ${branchY - cornerRadius}`;
                        // 上升到主线
                        pathData += ` L ${endX} ${mainY}`;
                        
                        const branchLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        branchLine.setAttribute('d', pathData);
                        branchLine.setAttribute('class', 'branch-line');
                        svg.appendChild(branchLine);
                    }
                    
                    currentBranchStart = null;
                }
            });
            
            // 绘制节点
            releases.forEach((release) => {
                const x = xScale(release.date);
                let y = mainY;
                
                // 确定节点的 y 坐标
                if (release.type === 'branch') {
                    y = branchY;
                }
                
                // 创建节点组
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', 'node');
                
                // 创建圆形节点
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 10);
                
                // 设置节点颜色
                let nodeClass = 'main-node';
                if (release.type === 'branch') {
                    nodeClass = 'branch-node';
                } else if (release.type === 'branch-start') {
                    nodeClass = 'branch-start-node';
                } else if (release.type === 'branch-merge') {
                    nodeClass = 'branch-merge-node';
                }
                circle.setAttribute('class', nodeClass);
                
                // 添加版本号标签
                const versionLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                versionLabel.setAttribute('x', x);
                versionLabel.setAttribute('y', y - 20);
                versionLabel.setAttribute('class', 'node-label');
                versionLabel.textContent = release.version.split('.').slice(-1)[0]; // 只显示最后一部分
                
                // 添加日期标签
                const dateLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dateLabel.setAttribute('x', x);
                dateLabel.setAttribute('y', y + 30);
                dateLabel.setAttribute('class', 'date-label');
                dateLabel.textContent = formatDate(release.date);
                
                g.appendChild(circle);
                g.appendChild(versionLabel);
                g.appendChild(dateLabel);
                
                // 添加交互事件
                g.addEventListener('mouseenter', (e) => showTooltip(e, release));
                g.addEventListener('mouseleave', hideTooltip);
                
                svg.appendChild(g);
            });
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            return `${month}.${day}`;
        }
        
        function showTooltip(event, release) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <div><strong>版本号：</strong>${release.version}</div>
                <div><strong>发布日期：</strong>${release.date}</div>
                <div><strong>部署环境：</strong>${release.environment}</div>
                <div><strong>版本类型：</strong>${release.note}</div>
            `;
            
            // 获取鼠标位置
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            
            // 设置 tooltip 位置
            tooltip.style.left = (mouseX + 15) + 'px';
            tooltip.style.top = (mouseY - 60) + 'px';
            
            // 显示 tooltip
            tooltip.classList.add('visible');
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('visible');
        }
        
        // 页面加载时绘制图表
        window.addEventListener('load', () => {
            drawDiagram(releasesData.releases);
        });
    </script>
</body>
</html>